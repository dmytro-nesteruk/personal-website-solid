import{e as Q,G as ne,H as se,f as oe,I as R,g as ue,C as I}from"./web-V2g5aTUJ.js";import{i as ce,j as de}from"./routing-CQ4lycLV.js";const le="Location",pe=5e3,ve=18e4;let T=new Map;setInterval(()=>{const e=Date.now();for(let[r,t]of T.entries())!t[3].count&&e-t[0]>ve&&T.delete(r)},3e5);function j(){return T}function Y(e,r){e.GET&&(e=e.GET);const t=(...a)=>{const i=j(),n=de(),s=ue()?ce():void 0,c=Date.now(),d=r+N(a);let o=i.get(d),h;if(ne()&&!se&&(h=!0,oe(()=>o[3].count--)),o&&o[0]&&(n==="native"||o[3].count||Date.now()-o[0]<pe)){h&&(o[3].count++,o[3][0]()),o[2]==="preload"&&n!=="preload"&&(o[0]=c);let g=o[1];return n!=="preload"&&(g="then"in o[1]?o[1].then(y(!1),y(!0)):y(!1)(o[1]),n==="navigate"&&R(()=>o[3][1](o[0]))),g}let v=I.context&&I.has(d)?I.load(d):e(...a);return o?(o[0]=c,o[1]=v,o[2]=n,n==="navigate"&&R(()=>o[3][1](o[0]))):(i.set(d,o=[c,v,n,Q(c)]),o[3].count=0),h&&(o[3].count++,o[3][0]()),n!=="preload"&&(v="then"in v?v.then(y(!1),y(!0)):y(!1)(v)),v;function y(g){return async l=>{if(l instanceof Response){if(l.headers.has("Location")){s&&R(()=>{let m=l.headers.get(le);m&&m.startsWith("/")?s(m,{replace:!0}):m&&(window.location.href=m)});return}l.customBody&&(l=await l.customBody())}if(g)throw l;return l}}};return t.keyFor=(...a)=>r+N(a),t.key=r,t}Y.set=(e,r)=>{const t=j(),a=Date.now();let i=t.get(e);i?(i[0]=a,i[1]=r,i[2]="preload"):(t.set(e,i=[a,r,,Q(a)]),i[3].count=0)};Y.clear=()=>j().clear();function N(e){return JSON.stringify(e,(r,t)=>fe(t)?Object.keys(t).sort().reduce((a,i)=>(a[i]=t[i],a),{}):t)}function fe(e){let r;return e!=null&&typeof e=="object"&&(!(r=Object.getPrototypeOf(e))||r===Object.prototype)}var he=(e=>(e[e.AggregateError=1]="AggregateError",e[e.ArrowFunction=2]="ArrowFunction",e[e.ErrorPrototypeStack=4]="ErrorPrototypeStack",e[e.ObjectAssign=8]="ObjectAssign",e[e.BigIntTypedArray=16]="BigIntTypedArray",e))(he||{});function ye(e){switch(e){case'"':return'\\"';case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"\b":return"\\b";case"	":return"\\t";case"\f":return"\\f";case"<":return"\\x3C";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return}}function f(e){let r="",t=0,a;for(let i=0,n=e.length;i<n;i++)a=ye(e[i]),a&&(r+=e.slice(t,i)+a,t=i+1);return t===0?r=e:r+=e.slice(t),r}var S="__SEROVAL_REFS__";function k(e,r){if(!e)throw r}var Z=new Map,E=new Map;function $(e){return Z.has(e)}function me(e){return k($(e),new Ye(e)),Z.get(e)}typeof globalThis<"u"?Object.defineProperty(globalThis,S,{value:E,configurable:!0,writable:!1,enumerable:!1}):typeof window<"u"?Object.defineProperty(window,S,{value:E,configurable:!0,writable:!1,enumerable:!1}):typeof self<"u"?Object.defineProperty(self,S,{value:E,configurable:!0,writable:!1,enumerable:!1}):typeof global<"u"&&Object.defineProperty(global,S,{value:E,configurable:!0,writable:!1,enumerable:!1});function ee(e,r){for(let t=0,a=r.length;t<a;t++){let i=r[t];e.has(i)||(e.add(i),i.extends&&ee(e,i.extends))}}function be(e){if(e){let r=new Set;return ee(r,e),[...r]}}var re={[Symbol.asyncIterator]:0,[Symbol.hasInstance]:1,[Symbol.isConcatSpreadable]:2,[Symbol.iterator]:3,[Symbol.match]:4,[Symbol.matchAll]:5,[Symbol.replace]:6,[Symbol.search]:7,[Symbol.species]:8,[Symbol.split]:9,[Symbol.toPrimitive]:10,[Symbol.toStringTag]:11,[Symbol.unscopables]:12},we={0:"Error",1:"EvalError",2:"RangeError",3:"ReferenceError",4:"SyntaxError",5:"TypeError",6:"URIError"};function p(e){return{t:2,i:void 0,s:e,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}var L=p(2),B=p(3),ge=p(1),Se=p(0),Ee=p(4),ze=p(5),Re=p(6),Ie=p(7);function C(e){return e instanceof EvalError?1:e instanceof RangeError?2:e instanceof ReferenceError?3:e instanceof SyntaxError?4:e instanceof TypeError?5:e instanceof URIError?6:0}function xe(e){let r=we[C(e)];return e.name!==r?{name:e.name}:e.constructor.name!==r?{name:e.constructor.name}:{}}function V(e,r){let t=xe(e),a=Object.getOwnPropertyNames(e);for(let i=0,n=a.length,u;i<n;i++)u=a[i],u!=="name"&&u!=="message"&&(u==="stack"?r&4&&(t=t||{},t[u]=e[u]):(t=t||{},t[u]=e[u]));return t}function te(e){return Object.isFrozen(e)?3:Object.isSealed(e)?2:Object.isExtensible(e)?0:1}function Ae(e){switch(e){case Number.POSITIVE_INFINITY:return ze;case Number.NEGATIVE_INFINITY:return Re}return e!==e?Ie:Object.is(e,-0)?Ee:{t:0,i:void 0,s:e,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function W(e){return{t:1,i:void 0,s:f(e),l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function Oe(e){return{t:3,i:void 0,s:""+e,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function Fe(e){return{t:4,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function Pe(e,r){return{t:5,i:e,s:r.toISOString(),l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,f:void 0,a:void 0,b:void 0,o:void 0}}function Te(e,r){return{t:6,i:e,s:void 0,l:void 0,c:f(r.source),m:r.flags,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function ke(e,r){let t=new Uint8Array(r),a=t.length,i=new Array(a);for(let n=0;n<a;n++)i[n]=t[n];return{t:19,i:e,s:i,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function $e(e,r){return{t:17,i:e,s:re[r],l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function G(e,r){return{t:18,i:e,s:f(me(r)),l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function je(e,r,t){return{t:25,i:e,s:t,l:void 0,c:f(r),m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function Ce(e,r,t){return{t:9,i:e,s:void 0,l:r.length,c:void 0,m:void 0,p:void 0,e:void 0,a:t,f:void 0,b:void 0,o:te(r)}}function Ue(e,r){return{t:21,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:r,b:void 0,o:void 0}}function Me(e,r,t){return{t:15,i:e,s:void 0,l:r.length,c:r.constructor.name,m:void 0,p:void 0,e:void 0,a:void 0,f:t,b:r.byteOffset,o:void 0}}function _e(e,r,t){return{t:16,i:e,s:void 0,l:r.length,c:r.constructor.name,m:void 0,p:void 0,e:void 0,a:void 0,f:t,b:r.byteOffset,o:void 0}}function De(e,r,t){return{t:20,i:e,s:void 0,l:r.byteLength,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:t,b:r.byteOffset,o:void 0}}function Ne(e,r,t){return{t:13,i:e,s:C(r),l:void 0,c:void 0,m:f(r.message),p:t,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function Le(e,r,t){return{t:14,i:e,s:C(r),l:void 0,c:void 0,m:f(r.message),p:t,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function Be(e,r,t){return{t:7,i:e,s:void 0,l:r,c:void 0,m:void 0,p:void 0,e:void 0,a:t,f:void 0,b:void 0,o:void 0}}function Ve(e,r){return{t:28,i:void 0,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:[e,r],f:void 0,b:void 0,o:void 0}}function We(e,r){return{t:30,i:void 0,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:[e,r],f:void 0,b:void 0,o:void 0}}function Ge(e,r,t){return{t:31,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:t,f:r,b:void 0,o:void 0}}function qe(e,r){return{t:32,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:r,b:void 0,o:void 0}}function He(e,r){return{t:33,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:r,b:void 0,o:void 0}}function Ke(e,r){return{t:34,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:r,b:void 0,o:void 0}}var{toString:U}=Object.prototype;function Xe(e,r){return r instanceof Error?`Seroval caught an error during the ${e} process.
  
${r.name}
${r.message}

- For more information, please check the "cause" property of this error.
- If you believe this is an error in Seroval, please submit an issue at https://github.com/lxsmnsyc/seroval/issues/new`:`Seroval caught an error during the ${e} process.

"${U.call(r)}"

For more information, please check the "cause" property of this error.`}var Je=class extends Error{constructor(r,t){super(Xe(r,t)),this.cause=t}},Qe=class extends Je{constructor(r){super("parsing",r)}},z=class extends Error{constructor(r){super(`The value ${U.call(r)} of type "${typeof r}" cannot be parsed/serialized.
      
There are few workarounds for this problem:
- Transform the value in a way that it can be serialized.
- If the reference is present on multiple runtimes (isomorphic), you can use the Reference API to map the references.`),this.value=r}},Ye=class extends Error{constructor(r){super('Missing reference for the value "'+U.call(r)+'" of type "'+typeof r+'"'),this.value=r}},Ze={},er={},rr={0:{},1:{},2:{},3:{},4:{}};function tr(e){return"__SEROVAL_STREAM__"in e}function M(){let e=new Set,r=[],t=!0,a=!1;function i(s){for(let c of e.keys())c.next(s)}function n(s){for(let c of e.keys())c.throw(s)}function u(s){for(let c of e.keys())c.return(s)}return{__SEROVAL_STREAM__:!0,on(s){t&&e.add(s);for(let c=0,d=r.length;c<d;c++){let o=r[c];c===d-1?a?s.return(o):s.throw(o):s.next(o)}return()=>{t&&e.delete(s)}},next(s){t&&(r.push(s),i(s))},throw(s){t&&(r.push(s),n(s),t=!1,a=!1,e.clear())},return(s){t&&(r.push(s),u(s),t=!1,a=!0,e.clear())}}}function ar(e){let r=M(),t=e[Symbol.asyncIterator]();async function a(){try{let i=await t.next();i.done?r.return(i.value):(r.next(i.value),await a())}catch(i){r.throw(i)}}return a().catch(()=>{}),r}function ir(e){let r=[],t=-1,a=-1,i=e[Symbol.iterator]();for(;;)try{let n=i.next();if(r.push(n.value),n.done){a=r.length-1;break}}catch(n){t=r.length,r.push(n)}return{v:r,t,d:a}}async function nr(e){try{return[1,await e]}catch(r){return[0,r]}}var sr=class{constructor(e){this.marked=new Set,this.plugins=e.plugins,this.features=31^(e.disabledFeatures||0),this.refs=e.refs||new Map}markRef(e){this.marked.add(e)}isMarked(e){return this.marked.has(e)}getIndexedValue(e){let r=this.refs.get(e);if(r!=null)return this.markRef(r),{type:1,value:Fe(r)};let t=this.refs.size;return this.refs.set(e,t),{type:0,value:t}}getReference(e){let r=this.getIndexedValue(e);return r.type===1?r:$(e)?{type:2,value:G(r.value,e)}:r}getStrictReference(e){k($(e),new z(e));let r=this.getIndexedValue(e);return r.type===1?r.value:G(r.value,e)}parseFunction(e){return this.getStrictReference(e)}parseWellKnownSymbol(e){let r=this.getReference(e);return r.type!==0?r.value:(k(e in re,new z(e)),$e(r.value,e))}parseSpecialReference(e){let r=this.getIndexedValue(rr[e]);return r.type===1?r.value:{t:26,i:r.value,s:e,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}parseIteratorFactory(){let e=this.getIndexedValue(Ze);return e.type===1?e.value:{t:27,i:e.value,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:this.parseWellKnownSymbol(Symbol.iterator),b:void 0,o:void 0}}parseAsyncIteratorFactory(){let e=this.getIndexedValue(er);return e.type===1?e.value:{t:29,i:e.value,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:[this.parseSpecialReference(1),this.parseWellKnownSymbol(Symbol.asyncIterator)],f:void 0,b:void 0,o:void 0}}createObjectNode(e,r,t,a){return{t:t?11:10,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:a,e:void 0,a:void 0,f:void 0,b:void 0,o:te(r)}}createMapNode(e,r,t,a){return{t:8,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:{k:r,v:t,s:a},a:void 0,f:this.parseSpecialReference(0),b:void 0,o:void 0}}createPromiseConstructorNode(e){return{t:22,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:this.parseSpecialReference(1),b:void 0,o:void 0}}},or=class extends sr{async parseItems(e){let r=[];for(let t=0,a=e.length;t<a;t++)t in e&&(r[t]=await this.parse(e[t]));return r}async parseArray(e,r){return Ce(e,r,await this.parseItems(r))}async parseProperties(e){let r=Object.entries(e),t=[],a=[];for(let n=0,u=r.length;n<u;n++)t.push(f(r[n][0])),a.push(await this.parse(r[n][1]));let i=Symbol.iterator;return i in e&&(t.push(this.parseWellKnownSymbol(i)),a.push(Ve(this.parseIteratorFactory(),await this.parse(ir(e))))),i=Symbol.asyncIterator,i in e&&(t.push(this.parseWellKnownSymbol(i)),a.push(We(this.parseAsyncIteratorFactory(),await this.parse(ar(e))))),i=Symbol.toStringTag,i in e&&(t.push(this.parseWellKnownSymbol(i)),a.push(W(e[i]))),i=Symbol.isConcatSpreadable,i in e&&(t.push(this.parseWellKnownSymbol(i)),a.push(e[i]?L:B)),{k:t,v:a,s:t.length}}async parsePlainObject(e,r,t){return this.createObjectNode(e,r,t,await this.parseProperties(r))}async parseBoxed(e,r){return Ue(e,await this.parse(r.valueOf()))}async parseTypedArray(e,r){return Me(e,r,await this.parse(r.buffer))}async parseBigIntTypedArray(e,r){return _e(e,r,await this.parse(r.buffer))}async parseDataView(e,r){return De(e,r,await this.parse(r.buffer))}async parseError(e,r){let t=V(r,this.features);return Ne(e,r,t?await this.parseProperties(t):void 0)}async parseAggregateError(e,r){let t=V(r,this.features);return Le(e,r,t?await this.parseProperties(t):void 0)}async parseMap(e,r){let t=[],a=[];for(let[i,n]of r.entries())t.push(await this.parse(i)),a.push(await this.parse(n));return this.createMapNode(e,t,a,r.size)}async parseSet(e,r){let t=[];for(let a of r.keys())t.push(await this.parse(a));return Be(e,r.size,t)}async parsePromise(e,r){let[t,a]=await nr(r);return{t:12,i:e,s:t,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:await this.parse(a),b:void 0,o:void 0}}async parsePlugin(e,r){let t=this.plugins;if(t)for(let a=0,i=t.length;a<i;a++){let n=t[a];if(n.parse.async&&n.test(r))return je(e,n.tag,await n.parse.async(r,this,{id:e}))}}async parseStream(e,r){return Ge(e,this.parseSpecialReference(4),await new Promise((t,a)=>{let i=[],n=r.on({next:u=>{this.markRef(e),this.parse(u).then(s=>{i.push(qe(e,s))},s=>{a(s),n()})},throw:u=>{this.markRef(e),this.parse(u).then(s=>{i.push(He(e,s)),t(i),n()},s=>{a(s),n()})},return:u=>{this.markRef(e),this.parse(u).then(s=>{i.push(Ke(e,s)),t(i),n()},s=>{a(s),n()})}})}))}async parseObject(e,r){if(Array.isArray(r))return this.parseArray(e,r);if(tr(r))return this.parseStream(e,r);let t=await this.parsePlugin(e,r);if(t)return t;let a=r.constructor;switch(a){case Object:return this.parsePlainObject(e,r,!1);case void 0:return this.parsePlainObject(e,r,!0);case Date:return Pe(e,r);case RegExp:return Te(e,r);case Error:case EvalError:case RangeError:case ReferenceError:case SyntaxError:case TypeError:case URIError:return this.parseError(e,r);case Number:case Boolean:case String:case BigInt:return this.parseBoxed(e,r);case ArrayBuffer:return ke(e,r);case Int8Array:case Int16Array:case Int32Array:case Uint8Array:case Uint16Array:case Uint32Array:case Uint8ClampedArray:case Float32Array:case Float64Array:return this.parseTypedArray(e,r);case DataView:return this.parseDataView(e,r);case Map:return this.parseMap(e,r);case Set:return this.parseSet(e,r)}if(a===Promise||r instanceof Promise)return this.parsePromise(e,r);let i=this.features;if(i&16)switch(a){case BigInt64Array:case BigUint64Array:return this.parseBigIntTypedArray(e,r)}if(i&1&&typeof AggregateError<"u"&&(a===AggregateError||r instanceof AggregateError))return this.parseAggregateError(e,r);if(r instanceof Error)return this.parseError(e,r);if(Symbol.iterator in r||Symbol.asyncIterator in r)return this.parsePlainObject(e,r,!!a);throw new z(r)}async parse(e){try{switch(typeof e){case"boolean":return e?L:B;case"undefined":return ge;case"string":return W(e);case"number":return Ae(e);case"bigint":return Oe(e);case"object":{if(e){let r=this.getReference(e);return r.type===0?await this.parseObject(r.value,e):r.value}return Se}case"symbol":return this.parseWellKnownSymbol(e);case"function":return this.parseFunction(e);default:throw new z(e)}}catch(r){throw new Qe(r)}}},ur=class extends or{constructor(){super(...arguments),this.mode="vanilla"}};function cr(e){return(0,eval)(e)}async function ae(e,r={}){let t=be(r.plugins),a=new ur({plugins:t,disabledFeatures:r.disabledFeatures});return{t:await a.parse(e),f:a.features,m:Array.from(a.marked)}}function x(e){return{detail:e.detail,bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}}var dr={tag:"seroval-plugins/web/CustomEvent",test(e){return typeof CustomEvent>"u"?!1:e instanceof CustomEvent},parse:{sync(e,r){return{type:r.parse(e.type),options:r.parse(x(e))}},async async(e,r){return{type:await r.parse(e.type),options:await r.parse(x(e))}},stream(e,r){return{type:r.parse(e.type),options:r.parse(x(e))}}},serialize(e,r){return"new CustomEvent("+r.serialize(e.type)+","+r.serialize(e.options)+")"},deserialize(e,r){return new CustomEvent(r.deserialize(e.type),r.deserialize(e.options))}},lr=dr,pr={tag:"seroval-plugins/web/DOMException",test(e){return typeof DOMException>"u"?!1:e instanceof DOMException},parse:{sync(e,r){return{name:r.parse(e.name),message:r.parse(e.message)}},async async(e,r){return{name:await r.parse(e.name),message:await r.parse(e.message)}},stream(e,r){return{name:r.parse(e.name),message:r.parse(e.message)}}},serialize(e,r){return"new DOMException("+r.serialize(e.message)+","+r.serialize(e.name)+")"},deserialize(e,r){return new DOMException(r.deserialize(e.message),r.deserialize(e.name))}},vr=pr;function A(e){return{bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}}var fr={tag:"seroval-plugins/web/Event",test(e){return typeof Event>"u"?!1:e instanceof Event},parse:{sync(e,r){return{type:r.parse(e.type),options:r.parse(A(e))}},async async(e,r){return{type:await r.parse(e.type),options:await r.parse(A(e))}},stream(e,r){return{type:r.parse(e.type),options:r.parse(A(e))}}},serialize(e,r){return"new Event("+r.serialize(e.type)+","+r.serialize(e.options)+")"},deserialize(e,r){return new Event(r.deserialize(e.type),r.deserialize(e.options))}},hr=fr,yr={tag:"seroval-plugins/web/File",test(e){return typeof File>"u"?!1:e instanceof File},parse:{async async(e,r){return{name:await r.parse(e.name),options:await r.parse({type:e.type,lastModified:e.lastModified}),buffer:await r.parse(await e.arrayBuffer())}}},serialize(e,r){return"new File(["+r.serialize(e.buffer)+"],"+r.serialize(e.name)+","+r.serialize(e.options)+")"},deserialize(e,r){return new File([r.deserialize(e.buffer)],r.deserialize(e.name),r.deserialize(e.options))}},mr=yr;function O(e){let r=[];return e.forEach((t,a)=>{r.push([a,t])}),r}var b={},br={tag:"seroval-plugins/web/FormDataFactory",test(e){return e===b},parse:{sync(){},async async(){return await Promise.resolve(void 0)},stream(){}},serialize(e,r){return r.createEffectfulFunction(["e","f","i","s","t"],"f=new FormData;for(i=0,s=e.length;i<s;i++)f.append((t=e[i])[0],t[1]);return f")},deserialize(){return b}},wr={tag:"seroval-plugins/web/FormData",extends:[mr,br],test(e){return typeof FormData>"u"?!1:e instanceof FormData},parse:{sync(e,r){return{factory:r.parse(b),entries:r.parse(O(e))}},async async(e,r){return{factory:await r.parse(b),entries:await r.parse(O(e))}},stream(e,r){return{factory:r.parse(b),entries:r.parse(O(e))}}},serialize(e,r){return"("+r.serialize(e.factory)+")("+r.serialize(e.entries)+")"},deserialize(e,r){let t=new FormData,a=r.deserialize(e.entries);for(let i=0,n=a.length;i<n;i++){let u=a[i];t.append(u[0],u[1])}return t}},gr=wr;function F(e){let r=[];return e.forEach((t,a)=>{r.push([a,t])}),r}var Sr={tag:"seroval-plugins/web/Headers",test(e){return typeof Headers>"u"?!1:e instanceof Headers},parse:{sync(e,r){return r.parse(F(e))},async async(e,r){return await r.parse(F(e))},stream(e,r){return r.parse(F(e))}},serialize(e,r){return"new Headers("+r.serialize(e)+")"},deserialize(e,r){return new Headers(r.deserialize(e))}},_=Sr,w={},Er={tag:"seroval-plugins/web/ReadableStreamFactory",test(e){return e===w},parse:{sync(){},async async(){return await Promise.resolve(void 0)},stream(){}},serialize(e,r){return r.createFunction(["d"],"new ReadableStream({start:"+r.createEffectfulFunction(["c"],"d.on({next:"+r.createEffectfulFunction(["v"],"c.enqueue(v)")+",throw:"+r.createEffectfulFunction(["v"],"c.error(v)")+",return:"+r.createEffectfulFunction([],"c.close()")+"})")+"})")},deserialize(){return w}};function q(e){let r=M(),t=e.getReader();async function a(){try{let i=await t.read();i.done?r.return(i.value):(r.next(i.value),await a())}catch(i){r.throw(i)}}return a().catch(()=>{}),r}var zr={tag:"seroval/plugins/web/ReadableStream",extends:[Er],test(e){return typeof ReadableStream>"u"?!1:e instanceof ReadableStream},parse:{sync(e,r){return{factory:r.parse(w),stream:r.parse(M())}},async async(e,r){return{factory:await r.parse(w),stream:await r.parse(q(e))}},stream(e,r){return{factory:r.parse(w),stream:r.parse(q(e))}}},serialize(e,r){return"("+r.serialize(e.factory)+")("+r.serialize(e.stream)+")"},deserialize(e,r){let t=r.deserialize(e.stream);return new ReadableStream({start(a){t.on({next(i){a.enqueue(i)},throw(i){a.error(i)},return(){a.close()}})}})}},D=zr;function H(e,r){return{body:r,cache:e.cache,credentials:e.credentials,headers:e.headers,integrity:e.integrity,keepalive:e.keepalive,method:e.method,mode:e.mode,redirect:e.redirect,referrer:e.referrer,referrerPolicy:e.referrerPolicy}}var Rr={tag:"seroval-plugins/web/Request",extends:[D,_],test(e){return typeof Request>"u"?!1:e instanceof Request},parse:{async async(e,r){return{url:await r.parse(e.url),options:await r.parse(H(e,e.body?await e.clone().arrayBuffer():null))}},stream(e,r){return{url:r.parse(e.url),options:r.parse(H(e,e.clone().body))}}},serialize(e,r){return"new Request("+r.serialize(e.url)+","+r.serialize(e.options)+")"},deserialize(e,r){return new Request(r.deserialize(e.url),r.deserialize(e.options))}},Ir=Rr;function K(e){return{headers:e.headers,status:e.status,statusText:e.statusText}}var xr={tag:"seroval-plugins/web/Response",extends:[D,_],test(e){return typeof Response>"u"?!1:e instanceof Response},parse:{async async(e,r){return{body:await r.parse(e.body?await e.clone().arrayBuffer():null),options:await r.parse(K(e))}},stream(e,r){return{body:r.parse(e.clone().body),options:r.parse(K(e))}}},serialize(e,r){return"new Response("+r.serialize(e.body)+","+r.serialize(e.options)+")"},deserialize(e,r){return new Response(r.deserialize(e.body),r.deserialize(e.options))}},Ar=xr,Or={tag:"seroval-plugins/web/URLSearchParams",test(e){return typeof URLSearchParams>"u"?!1:e instanceof URLSearchParams},parse:{sync(e,r){return r.parse(e.toString())},async async(e,r){return await r.parse(e.toString())},stream(e,r){return r.parse(e.toString())}},serialize(e,r){return"new URLSearchParams("+r.serialize(e)+")"},deserialize(e,r){return new URLSearchParams(r.deserialize(e))}},Fr=Or,Pr={tag:"seroval-plugins/web/URL",test(e){return typeof URL>"u"?!1:e instanceof URL},parse:{sync(e,r){return r.parse(e.href)},async async(e,r){return await r.parse(e.href)},stream(e,r){return r.parse(e.href)}},serialize(e,r){return"new URL("+r.serialize(e)+")"},deserialize(e,r){return new URL(r.deserialize(e))}},Tr=Pr;class kr{reader;buffer;done;constructor(r){this.reader=r.getReader(),this.buffer="",this.done=!1}async readChunk(){const r=await this.reader.read();r.done?this.done=!0:this.buffer+=new TextDecoder().decode(r.value)}async next(){if(this.buffer==="")return this.done?{done:!0,value:void 0}:(await this.readChunk(),await this.next());const r=Number.parseInt(this.buffer.substring(1,11),16);for(;r>this.buffer.length-12;){if(this.done)throw new Error("Malformed server function stream.");await this.readChunk()}const t=this.buffer.substring(12,12+r);return this.buffer=this.buffer.substring(12+r),{done:!1,value:cr(t)}}async drain(){for(;!(await this.next()).done;);}}async function X(e,r){if(!r.body)throw new Error("missing body");const t=new kr(r.body),a=await t.next();return a.done||t.drain().then(()=>{delete $R[e]},()=>{}),a.value}let $r=0;function P(e,r,t,a){return fetch(e,{method:"POST",...a,headers:{...a.headers,"X-Server-Id":r,"X-Server-Instance":t}})}const ie=[lr,vr,hr,gr,_,D,Ir,Ar,Fr,Tr];async function J(e,r,t,a){const i=`server-fn:${$r++}`,n=await(a.length===0?P(e,r,i,t):a.length===1&&a[0]instanceof FormData?P(e,r,i,{...t,body:a[0]}):P(e,r,i,{...t,body:JSON.stringify(await Promise.resolve(ae(a,{plugins:ie}))),headers:{...t.headers,"Content-Type":"application/json"}}));if(n.headers.get("Location")||n.headers.get("X-Revalidate")||n.headers.get("X-Single-Flight"))return n.body&&(n.customBody=()=>X(i,n)),n;const u=n.headers.get("Content-Type");let s;if(u&&u.startsWith("text/plain")?s=await n.text():u&&u.startsWith("application/json")?s=await n.json():s=await X(i,n),n.headers.has("X-Error"))throw s;return s}function Nr(e,r,t){const a="";return new Proxy(e,{get(i,n,u){if(n==="url")return`${a}/_server?id=${encodeURIComponent(r)}&name=${encodeURIComponent(t)}`;if(n==="GET")return u.withOptions({method:"GET"});if(n==="withOptions"){const s=`${a}/_server/?id=${encodeURIComponent(r)}&name=${encodeURIComponent(t)}`;return c=>{const d=async(...o)=>{const h=c.method&&c.method.toUpperCase()==="GET";return J(h?s+(o.length?`&args=${JSON.stringify(await Promise.resolve(ae(o,{plugins:ie})))}`:""):`${a}/_server`,`${r}#${t}`,c,h?[]:o)};return d.url=s,d}}},apply(i,n,u){return J(`${a}/_server`,`${r}#${t}`,{},u)}})}export{Nr as a,Y as c};
